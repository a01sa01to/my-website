<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
<link
  rel="icon"
  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%%22 y=%2250%%22 style=%22dominant-baseline:central;text-anchor:middle;font-size:60px;font-family:cursive;%22 fill=%22%230d47a1%22>Asa</text></svg>"
/>
<meta
  name="viewport"
  content="width=device-width,minimum-scale=1.0, initial-scale=1.0, maximum-scale=10.0, shrink-to-fit=no"
/>
 
<meta name="keywords" content="a01sa01to" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:domain" content="https://a01sa01to.com/" />
<meta name="twitter:site" content="@a01sa01to" />
<meta name="twitter:creator" content="@a01sa01to" />
<meta
  property="og:url"
  content="https://a01sa01to.com/blog/2021/06/cleaning-up-my-computer"
/>
<meta property="og:title" content=" - Asa's Blog" lang="ja"> <meta
property="og:title" content=" -
Asa's Blog" lang="en">
<meta property="og:image" content="https://a01sa01to.com/img/twittercard.jpg" />
<meta property="og:type" content="website" />
<link
  rel="canonical"
  href="https://a01sa01to.com/blog/2021/06/cleaning-up-my-computer"
/>

<!-- Change Chrome Tab Color -->
<meta name="theme-color" content="#ffffff" />

    <title>Cleaning Up My Computer - Asa's Blog</title>
    <link type="application/atom+xml" rel="alternate" href="https://a01sa01to.com/feed.xml" title="Asa's Website" /> <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
  crossorigin="anonymous"
/>
<link rel="stylesheet" href="/css/main.css" />
 <script
  src="https://kit.fontawesome.com/7fba4a39db.js"
  crossorigin="anonymous"
  async
></script>
<script src="/bundle.js"></script>
<script
  data-ad-client="ca-pub-3296104264173235"
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-Z23EQDNLQY"
></script>
<script>
  window.dataLayer = window.dataLayer || []
  function gtag() {
    dataLayer.push(arguments)
  }
  gtag('js', new Date())

  gtag('config', 'G-Z23EQDNLQY')
</script>

    <link rel="canonical" href="https://a01sa01to.com/blog/2021/06/cleaning-up-my-computer" />
    <link rel="stylesheet" href="/css/blog_post.css" />
  </head>
  <body id="top">
    <header>
      <div id="left"></div>
<div id="center">
  <p id="title">Asa's Blog</p>
</div>
<div id="right">
  <input type="checkbox" id="menuShow" />
  <div id="menuIcon">
    <div id="bar1"></div>
    <div id="bar2"></div>
  </div>
  <div id="menuItem">
    <li><a href="/blog/">Blog Top</a></li>
    
    <p class="border"></p>
    <li><a href="/">Asa's Website Home</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/opendata/">Opendata Catalog</a></li>
    <li><a href="/works">Works</a></li>
    <li><a href="/sitemap/">Sitemap</a></li>
    <li class="social">
      <a
        href="https://github.com/a01sa01to"
        target="_blank"
        rel="noopener noreferrer"
      >
        <i class="fab fa-github"></i>
      </a>
      <a
        href="https://twitter.com/a01sa01to"
        target="_blank"
        rel="noopener noreferrer"
      >
        <i class="fab fa-twitter"></i>
      </a>
      <a
        href="https://instagram.com/a01sa01to"
        target="_blank"
        rel="noopener noreferrer"
      >
        <i class="fab fa-instagram"></i>
      </a>
      <a href="/feed.xml" target="_blank" rel="noopener">
        <i class="fas fa-rss"></i>
      </a>
    </li>
    
    <li style="height: 54px"></li>
  </div>
</div>

    </header>
    <main>
      <div class="container">
        <div>
          <h1>Cleaning Up My Computer</h1>
          
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb" lang="ja">
              <li class="breadcrumb-item"><a href="/blog/">Home</a></li>
              <li class="breadcrumb-item">
                <a href="/blog/list/2021">2021年の記事</a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                この記事
              </li>
            </ol>
          </nav>

          <p class="tags">
            Tags: 
            <a href="/blog/tags/computer/" class="tag"
              ><nobr>Computer</nobr></a
            >&nbsp; 
          </p>
          <p class="date">
             
            <nobr
              >Published on 2021.06.24.<wbr /> Last
              Modified on 2021.06.24.</nobr
            >
          </p>
          <div class="accordion" id="toc">
            <div class="accordion-item">
              <p class="accordion-header" id="headingToc">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseToc"
                  aria-expanded="false"
                  aria-controls="collapseToc"
                >
                  Table of Contents
                </button>
              </p>
              <div
                id="collapseToc"
                class="accordion-collapse collapse"
                aria-labelledby="headingToc"
                data-bs-parent="#toc"
              >
                <div class="accordion-body"></div>
              </div>
            </div>
          </div>
          <div class="article">
            <p>クリーンアップって大事ですよね……。</p>

<p>ただパソコンのクリーンアップをするだけの記事です。</p>

<h2 id="使用容量を確認してみる">使用容量を確認してみる</h2>

<p>スクショ取り忘れました…。空き容量は 31.8GB です。ここからどのくらい減るか見ものです。</p>

<h2 id="不要ファイルを削除していく">不要ファイルを削除していく</h2>

<h3 id="不要なプログラムを削除">不要なプログラムを削除</h3>

<p>はい、まず最初にやるべきことと言ったらこれです。不要なプログラムをアンインストールします。</p>

<p>「設定 &gt; アプリ &gt; アプリと機能 &gt; （アプリ選択） &gt; アンインストール」です。全く使っていないアプリ（1 桁台）をアンインストール。<br />
プログラムサイズが小さかったのか、消すプログラムが少なかったのか、3GB くらいしか増えず…。</p>

<h3 id="フォルダ整理">フォルダ整理</h3>

<p>とりあえず、今後見やすくするために、空フォルダを削除していきます。</p>

<p>Powershell で削除したい親フォルダに移動した後、以下のコマンドを実行します。子孫フォルダが多いと、かなり時間がかかります。<br />
（※一応動作確認はしていますが、以下のコマンドを実行したことにより生じた損害については責任を負いかねます）</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Measure-Command</span><span class="p">{</span><span class="w">
  </span><span class="nv">$dirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Directory</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
  </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$dir</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$dirs</span><span class="p">){</span><span class="w">
    </span><span class="nv">$item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$dir</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w">
    </span><span class="kr">if</span><span class="p">(</span><span class="nv">$item</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">
      </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Deleting </span><span class="nv">$dir</span><span class="s2">"</span><span class="w">
      </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nv">$dir</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$dirs</code>に子孫フォルダを保存し、それぞれについて、ファイル数が 0 なら削除、といった流れです。<code class="language-plaintext highlighter-rouge">Measure-Command</code>で時間計測をしています。</p>

<p><code class="language-plaintext highlighter-rouge">%UserProfile%</code>フォルダで試してみた結果、1464 フォルダが削除されました。実行時間は 13 分 11 秒でした。</p>

<h3 id="windows-のクリーンアップ機能を使う">Windows のクリーンアップ機能を使う</h3>

<p>Windows に標準搭載されている、クリーンアップツールを使います。<br />
エクスプローラーで、C ドライブなどを選択して、上の「管理・ドライブツール」にあるやつです。</p>

<p><img src="/img/blog/2021/06/cleaning-up/01.png" alt="2GB増やせるみたい" /></p>

<p>33.7GB まで空きました。</p>

<h3 id="tempフォルダを消す">%temp%フォルダを消す</h3>

<p>一応、ある程度は上のツールで消えてくれるんですが、まだ割と残っているので、エクスプローラーから削除します。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nv">$</span><span class="nn">ENV</span><span class="p">:</span><span class="nv">temp</span><span class="w">
</span><span class="n">Measure-Command</span><span class="p">{</span><span class="w">
  </span><span class="nv">$dirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Directory</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
  </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$dir</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$dirs</span><span class="p">){</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Deleting </span><span class="nv">$dir</span><span class="s2">"</span><span class="w">
    </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nv">$dir</span><span class="w"> </span><span class="nt">-force</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nv">$files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w">
  </span><span class="nx">foreach</span><span class="p">(</span><span class="nv">$file</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$files</span><span class="p">){</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Deleting </span><span class="nv">$file</span><span class="s2">"</span><span class="w">
    </span><span class="n">Remove-Item</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="nt">-force</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>空き容量は 35.3GB です。そこまで期待はしていませんでした。</p>

<h3 id="ccleaner-で消していく">CCleaner で消していく</h3>

<p>クリーニングソフトでは有名な、<a href="https://www.ccleaner.com/">CCleaner</a> を使って消していきます。</p>

<p><img src="/img/blog/2021/06/cleaning-up/02.png" alt="Custom Cleanをしてみる" /></p>

<p>スキャンしてみた結果、「約 4,687MB（=4.58GB）消せそう」と出ていましたが、実際に消してみると 5,139MB（=5.02GB）消せました。<br />空き容量は 39.8GB になりました。</p>

<p>ついでにレジストリも削除しました。</p>

<h3 id="手作業で消していく">手作業で消していく</h3>

<p>はい、結局これに尽きます。アンインストールしたソフトでも、完全にはファイルが消えているわけではないので。</p>

<p>以下のコードは、開いたフォルダ内のファイルのうち、最新の書き込み日時を取得して出力するコードです。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Measure-Command</span><span class="p">{</span><span class="w">
  </span><span class="nv">$dirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Descending</span><span class="w">
  </span><span class="p">[</span><span class="n">System.Datetime</span><span class="p">]</span><span class="w"> </span><span class="nv">$lastUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2000/01/01 00:00"</span><span class="w">
  </span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$dir</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$dirs</span><span class="p">){</span><span class="w">
    </span><span class="kr">if</span><span class="p">(</span><span class="nv">$dir</span><span class="o">.</span><span class="nf">LastWriteTime</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="nv">$lastUpdate</span><span class="p">){</span><span class="w">
      </span><span class="nv">$lastUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$dir</span><span class="o">.</span><span class="nf">LastWriteTime</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Last Update: </span><span class="nv">$lastUpdate</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>要らなさそうなファイルを消した結果、47.6GB まで増えました。<br />
（アンインストールしたプログラムや、Cache フォルダ、最終更新から 1 年経っているフォルダなどを削除しました）</p>

<p>この後に念のため、CCleaner のレジストリクリーナーを走らせました。</p>

<h3 id="git-フォルダの軽量化">.git フォルダの軽量化</h3>

<p>C ドライブの Documents フォルダ内に Git 管理のプログラムを大量においていたため、Git により容量が使われている可能性があったので、軽量化します。</p>

<p>なお、日をまたいでしまったので 45.0GB にリバウンドしました()。</p>

<p>さて、Git リポジトリで以下のコマンドを実行します。<br />
<a href="https://git-scm.com/book/ja/v2/Git%E3%81%AE%E5%86%85%E5%81%B4-%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%AA%E3%82%AB%E3%83%90%E3%83%AA">Git - メンテナンスとデータリカバリ</a></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">git</span><span class="w"> </span><span class="nx">gc</span><span class="w">
</span></code></pre></div></div>

<p>例えば、<a href="https://github.com/a01sa01to/covid19-ibaraki">a01sa01to/covid19-ibaraki</a> における <code class="language-plaintext highlighter-rouge">.git</code> フォルダの容量は、4.72GB から 4.68GB に減りました。ほんとに誤差ですね…。ちなみに 12 分かかりました。</p>

<h3 id="node_modules-フォルダの軽量化">node_modules フォルダの軽量化</h3>

<p>node_modules フォルダによっても容量が使われている可能性があったので、軽量化します。</p>

<p>この手法は npm を利用している場合有効で、Yarn を利用している場合は必要ないようです。<br />
Yarn の場合 <code class="language-plaintext highlighter-rouge">yarn install</code> 時に<a href="https://classic.yarnpkg.com/en/docs/cli/prune/">自動で軽量化される</a>らしいです。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npm</span><span class="w"> </span><span class="nx">prune</span><span class="w">
</span></code></pre></div></div>

<p>えっと、npm を使っているプロジェクトがありませんでした…笑</p>

<p>次に、Yarn で不要なファイルを削除します。上の代替なのかもしれませんが。</p>

<table>
  <tbody>
    <tr>
      <td>注意（[yarn autoclean</td>
      <td>Yarn](https://classic.yarnpkg.com/en/docs/cli/autoclean)より意訳）</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>このコマンドは上級者向けと思っておいてください。<code class="language-plaintext highlighter-rouge">node_modules</code> 内に大量のファイルがあることで問題が生じているとき以外は、このコマンドは推奨されません。<code class="language-plaintext highlighter-rouge">node_modules</code>内のファイルを恒久的に削除するため、パッケージが停止する原因になり得ます。</p>
</blockquote>

<p>はい、やっていきます。（なにか損害が生じても責任は負いかねますよ。）</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yarn</span><span class="w"> </span><span class="nx">autoclean</span><span class="w"> </span><span class="nt">--init</span><span class="w">
</span><span class="n">yarn</span><span class="w"> </span><span class="nx">autoclean</span><span class="w"> </span><span class="nt">--force</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">yarn autoclean --init</code> で <code class="language-plaintext highlighter-rouge">.yarnclean</code> ファイルを作成します。このファイルが存在すると、<code class="language-plaintext highlighter-rouge">yarn install</code> や <code class="language-plaintext highlighter-rouge">yarn add</code> の際に自動的に不要ファイルが削除されるとのことです。<br />
でも、もうすでに <code class="language-plaintext highlighter-rouge">yarn install</code> はしてあるし、<code class="language-plaintext highlighter-rouge">yarn add</code> するパッケージもない…ということで、<code class="language-plaintext highlighter-rouge">yarn autoclean --force</code> で実行しています。</p>

<p>再び <a href="https://github.com/a01sa01to/covid19-ibaraki">a01sa01to/covid19-ibaraki</a> で実験してみた結果、3,697 ファイルが削除され、14.23MB が空きました。ちなみに実行時間は 25.43 秒でした。十分高速。</p>

<h2 id="結果は">結果は…？</h2>

<p>前述したように、日をまたぐ前は <del>47.6GB</del> 47.8GB まで増えました。<br />
日をまたいだことにより 45.0GB までリバウンドしましたが、45.2GB まで増加。</p>

<p><img src="/img/blog/2021/06/cleaning-up/03.png" alt="47.8GBまで増えた！" /></p>

<p>内訳は上の画像の通り。システムは変更できないけど、「アプリと機能」も必要なものしか残っていないはず…です。たぶん。</p>

<p>上記以外にもいろいろな手法を試してみたいと思います。</p>

            <p class="a_few_word">年末にOSごとクリーンアップするのもありかも...？</p>
          </div>
        </div>
      </div>
    </main>
    <footer><div class="sb">
  Share this page!
  <div class="sbInner">
    <!-- Facebook -->
    <a
      class="shadow-lg mb-5 rounded sBtn sBtn-facebook"
      href="https://www.facebook.com/sharer/sharer.php?u=PAGEURL"
      rel="nofollow"
      target="_blank"
      title="Share on Facebook"
      ><i class="fab fa-facebook-f"></i
    ></a>
    <!-- Twitter -->
    <a
      class="shadow-lg mb-5 rounded sBtn sBtn-twitter"
      href="http://twitter.com/share?url=PAGEURL&text=PAGETITLE&via=a01sa01to"
      rel="nofollow"
      target="_blank"
      title="Share on Twitter"
      ><i class="fab fa-twitter"></i
    ></a>
    <!-- LINE -->
    <a
      class="shadow-lg mb-5 rounded sBtn sBtn-line"
      href="http://line.me/R/msg/text/?PAGETITLE%0APAGEURL"
      rel="nofollow"
      target="_blank"
      title="Share on LINE"
      ><i class="fab fa-line"></i
    ></a>
    <!-- Pocket -->
    <a
      class="shadow-lg mb-5 rounded sBtn sBtn-pocket"
      href="https://getpocket.com/edit?url=PAGEURL&title=PAGETITLE"
      rel="nofollow"
      target="blank"
      title="Share on Pocket"
      ><i class="fab fa-get-pocket"></i
    ></a>
    <!-- B! Hatena -->
    <a
      class="shadow-lg mb-5 rounded sBtn sBtn-hatena"
      href="https://b.hatena.ne.jp/add?mode=confirm&url=PAGEURL&title=PAGETITLE"
      rel="nofollow"
      target="_blank"
      title="Share on Hatena"
      ><i aria-hidden="true" class="fa fa-hatena" style="font-weight: bold"
        >B!</i
      ></a
    >
  </div>
</div>

<p id="copyright">Copyright &copy; 2020-2021 Asa(@a01sa01to)</p>
</footer>
    <a href="#top" id="gototop"
      ><span class="material-icons">keyboard_arrow_up</span></a
    >
  </body>
</html>
